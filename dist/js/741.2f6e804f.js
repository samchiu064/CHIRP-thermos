"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[741],{741:function(t,e,o){o.r(e),o.d(e,{default:function(){return Q}});var a=o(3396),n=o(7139);const s={class:"text-end mt-3"},l={class:"table mt-4"},d=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"名稱"),(0,a._)("th",{width:"120"},"折扣百分比"),(0,a._)("th",{width:"120"},"到期日"),(0,a._)("th",{width:"120"},"折扣碼"),(0,a._)("th",{width:"120"},"是否啟用"),(0,a._)("th",{width:"200"},"編輯")])],-1),i={key:0,class:"text-success"},p={key:1,class:"text-secondary"},u={class:"btn-group"},c=["onClick"],r=["onClick"];function m(t,e,o,m,h,b){const _=(0,a.up)("LoadingOverlay"),g=(0,a.up)("DashboardModalCoupon"),C=(0,a.up)("DashboardModalDelete"),w=(0,a.up)("ThePagination");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(_,{active:h.isLoading},null,8,["active"]),(0,a._)("div",s,[(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=t=>b.openModal(!0))},"建立新的優惠券")]),(0,a._)("table",l,[d,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.coupons,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,n.zw)(t.title),1),(0,a._)("td",null,(0,n.zw)(t.percent)+"%",1),(0,a._)("td",null,(0,n.zw)(t.due_date),1),(0,a._)("td",null,(0,n.zw)(t.code),1),(0,a._)("td",null,[t.is_enabled?((0,a.wg)(),(0,a.iD)("span",i,"啟用")):((0,a.wg)(),(0,a.iD)("span",p,"未啟用"))]),(0,a._)("td",null,[(0,a._)("div",u,[(0,a._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e=>b.openModal(!1,t)}," 編輯 ",8,c),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>b.openDeleteModal(!1,t)}," 刪除 ",8,r)])])])))),128))])]),(0,a.Wm)(g,{ref:"couponModal",onUpdateCoupon:b.updateCoupon,coupon:h.tempCoupon},null,8,["onUpdateCoupon","coupon"]),(0,a.Wm)(C,{ref:"deleteModal",onDeleteItem:b.deleteCoupon,item:h.tempCoupon},null,8,["onDeleteItem","item"]),(0,a.Wm)(w,{pages:h.pagination,onEmitPage:b.getCoupons},null,8,["pages","onEmitPage"])],64)}var h=o(506),b=o(9242);const _={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},g={class:"modal-dialog modal-sm",role:"document"},C={class:"modal-content border-0"},w=(0,a._)("div",{class:"modal-header bg-dark text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,a._)("span",null,"新增折扣碼")]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),f={class:"modal-body"},y={class:"row"},M={class:"col-sm-12"},v={class:"mb-3"},k={for:"title",class:"form-label w-100"},D=(0,a.Uk)("優惠券名稱 "),x={class:"mb-3 col-md-12"},U={for:"percentage",class:"form-label w-100"},L=(0,a.Uk)("折扣百分比 "),S={class:"mb-3 col-md-12"},$={for:"due_date",class:"form-label w-100"},N=(0,a.Uk)("到期日 "),V={class:"mb-3 col-md-12"},Z={for:"coupon_code",class:"form-label w-100"},z=(0,a.Uk)("折扣碼 "),P={class:"mb-3"},W={class:"form-check"},j={class:"form-check-label",for:"is_enabled"},E=(0,a.Uk)(" 是否啟用 "),F={class:"modal-footer"},T=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Y(t,e,o,n,s,l){return(0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("div",g,[(0,a._)("div",C,[w,(0,a._)("div",f,[(0,a._)("div",y,[(0,a._)("div",M,[(0,a._)("div",v,[(0,a._)("label",k,[D,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":e[0]||(e[0]=t=>s.tempCoupon.title=t)},null,512),[[b.nr,s.tempCoupon.title]])])]),(0,a._)("div",x,[(0,a._)("label",U,[L,(0,a.wy)((0,a._)("input",{type:"number",min:0,max:100,class:"form-control",id:"percentage",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[1]||(e[1]=t=>s.tempCoupon.percent=t)},null,512),[[b.nr,s.tempCoupon.percent,void 0,{number:!0}]])])]),(0,a._)("div",S,[(0,a._)("label",$,[N,(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=t=>s.tempCoupon.due_date=t)},null,512),[[b.nr,s.tempCoupon.due_date]])])]),(0,a._)("div",V,[(0,a._)("label",Z,[z,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入折扣碼","onUpdate:modelValue":e[3]||(e[3]=t=>s.tempCoupon.code=t)},null,512),[[b.nr,s.tempCoupon.code]])])]),(0,a._)("div",P,[(0,a._)("div",W,[(0,a._)("label",j,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=t=>s.tempCoupon.is_enabled=t)},null,512),[[b.e8,s.tempCoupon.is_enabled]]),E])])])])])]),(0,a._)("div",F,[T,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...t)=>l.updateCoupon&&l.updateCoupon(...t))},"確認")])])])],512)}var H=o(1339),I={mixins:[H.Z],props:["coupon"],data(){return{modal:{},tempCoupon:{}}},computed:{formattedCoupon(){return{...this.tempCoupon,percent:this.tempCoupon.percent?this.tempCoupon.percent:100,due_date:new Date(this.tempCoupon.due_date).getTime(),is_enabled:this.tempCoupon.is_enabled||0}}},watch:{coupon(){this.tempCoupon=this.coupon}},methods:{updateCoupon(){this.$emit("update-coupon",this.formattedCoupon)}}},J=o(89);const K=(0,J.Z)(I,[["render",Y]]);var O=K,q=o(8198),A=o(3267),B={components:{DashboardModalCoupon:O,DashboardModalDelete:q.Z,ThePagination:A.Z},inject:["pushMessageState"],data(){return{tempCoupon:{},coupons:[],pagination:{},isNew:!1,isLoading:!1}},methods:{openModal(t,e){this.tempCoupon=t?{}:e,this.$refs.couponModal.showModal(),this.isNew=t},openDeleteModal(t,e){this.tempCoupon=e,this.$refs.deleteModal.showModal(),this.isNew=t},async updateCoupon(t){if(this.isLoading=!0,this.isNew)try{const e=await(0,h.Ff)({data:t});this.pushMessageState(e,"優惠券資料建立")}catch(e){this.pushMessageState(e,"優惠券資料建立")}if(!this.isNew)try{const e=await(0,h.Fn)({data:t});this.pushMessageState(e,"優惠券資料更新")}catch(e){this.pushMessageState(e,"優惠券資料更新")}this.isLoading=!1,this.$refs.couponModal.hideModal(),this.getCoupons()},async deleteCoupon(){this.isLoading=!0;try{const t=await(0,h.D_)(this.tempCoupon.id);this.pushMessageState(t,"優惠券資料刪除")}catch(t){this.pushMessageState(t,"優惠券資料刪除")}this.isLoading=!1,this.$refs.deleteModal.hideModal(),this.getCoupons()},async getCoupons(t=1){this.isLoading=!0;try{const e=await(0,h.lJ)(t);console.log(e),this.coupons=e.data.coupons,this.pagination=e.data.pagination,this.coupons.forEach(((t,e)=>{this.coupons[e].due_date=this.getCurrentDate(t.due_date)})),this.pushMessageState(e,"優惠券資料獲取")}catch(e){this.pushMessageState(e,"優惠券資料獲取")}this.isLoading=!1},getCurrentDate(t){const e=new Date(t),o=e.getFullYear(),a=(e.getMonth()+1<10?"0":"")+(e.getMonth()+1),n=(e.getDate()<10?"0":"")+e.getDate();return`${o}-${a}-${n}`}},created(){this.getCoupons()}};const G=(0,J.Z)(B,[["render",m]]);var Q=G}}]);
//# sourceMappingURL=741.2f6e804f.js.map